<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report to Markdown Converter</title>
    <!-- Mammoth.js for Word document conversion -->
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .panel {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }
        .file-input {
            margin-bottom: 20px;
        }
        .output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>üìÑ Report to Markdown Converter</h1>
    <p>Upload a Word document (.docx) to convert it to Markdown format</p>
    
    <div class="file-input">
        <input type="file" id="docxFile" accept=".docx" />
        <button onclick="convertToMarkdown()">Convert to Markdown</button>
    </div>
    
    <div class="container">
        <div class="panel">
            <h3>üìã HTML Preview</h3>
            <div id="htmlOutput" class="output">Upload a .docx file to see HTML output here...</div>
        </div>
        
        <div class="panel">
            <h3>üìù Markdown Output</h3>
            <div id="markdownOutput" class="output">Upload a .docx file to see Markdown output here...</div>
            <button onclick="copyMarkdown()" style="margin-top: 10px;">Copy Markdown</button>
        </div>
    </div>

    <script>
        async function convertToMarkdown() {
            const fileInput = document.getElementById('docxFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a .docx file first');
                return;
            }
            
            if (!file.name.endsWith('.docx')) {
                alert('Please select a valid .docx file');
                return;
            }
            
            try {
                // Convert Word document to HTML using Mammoth.js
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.convertToHtml({ arrayBuffer });
                
                // Display HTML output
                document.getElementById('htmlOutput').innerHTML = result.value;
                
                // Convert HTML to Markdown (basic conversion)
                const markdown = htmlToMarkdown(result.value);
                document.getElementById('markdownOutput').textContent = markdown;
                
                // Log any conversion messages/warnings
                if (result.messages.length > 0) {
                    console.log('Conversion messages:', result.messages);
                }
                
            } catch (error) {
                console.error('Error converting document:', error);
                alert('Error converting document: ' + error.message);
            }
        }
        
        function htmlToMarkdown(html) {
            // Basic HTML to Markdown conversion
            let markdown = html;
            
            // Headers
            markdown = markdown.replace(/<h1[^>]*>(.*?)<\/h1>/gi, '# $1\n\n');
            markdown = markdown.replace(/<h2[^>]*>(.*?)<\/h2>/gi, '## $1\n\n');
            markdown = markdown.replace(/<h3[^>]*>(.*?)<\/h3>/gi, '### $1\n\n');
            markdown = markdown.replace(/<h4[^>]*>(.*?)<\/h4>/gi, '#### $1\n\n');
            markdown = markdown.replace(/<h5[^>]*>(.*?)<\/h5>/gi, '##### $1\n\n');
            markdown = markdown.replace(/<h6[^>]*>(.*?)<\/h6>/gi, '###### $1\n\n');
            
            // Paragraphs
            markdown = markdown.replace(/<p[^>]*>(.*?)<\/p>/gi, '$1\n\n');
            
            // Bold and italic
            markdown = markdown.replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**');
            markdown = markdown.replace(/<b[^>]*>(.*?)<\/b>/gi, '**$1**');
            markdown = markdown.replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*');
            markdown = markdown.replace(/<i[^>]*>(.*?)<\/i>/gi, '*$1*');
            
            // Lists
            markdown = markdown.replace(/<ul[^>]*>/gi, '');
            markdown = markdown.replace(/<\/ul>/gi, '\n');
            markdown = markdown.replace(/<ol[^>]*>/gi, '');
            markdown = markdown.replace(/<\/ol>/gi, '\n');
            markdown = markdown.replace(/<li[^>]*>(.*?)<\/li>/gi, '- $1\n');
            
            // Links
            markdown = markdown.replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)');
            
            // Line breaks
            markdown = markdown.replace(/<br[^>]*>/gi, '\n');
            
            // Remove remaining HTML tags
            markdown = markdown.replace(/<[^>]*>/g, '');
            
            // Clean up extra whitespace
            markdown = markdown.replace(/\n{3,}/g, '\n\n');
            markdown = markdown.trim();
            
            return markdown;
        }
        
        function copyMarkdown() {
            const markdownText = document.getElementById('markdownOutput').textContent;
            if (markdownText && markdownText !== 'Upload a .docx file to see Markdown output here...') {
                navigator.clipboard.writeText(markdownText).then(() => {
                    alert('Markdown copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    alert('Failed to copy to clipboard');
                });
            } else {
                alert('No markdown content to copy');
            }
        }
    </script>
</body>
</html>